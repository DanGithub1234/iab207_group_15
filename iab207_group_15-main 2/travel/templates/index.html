{% extends 'base.html' %}

{% block header %}
<div class="first-container">
  <div class="row">
    <!-- jumbotron -->
    <div class="p-5 col-md-12">
      <div class="myjumbotron1 p-5 mb-2 rounded-3 text-secondary-emphasis opacity-70">
        <div class="container-fluid py-5">
          <img src="" alt="">
          <h1 class="display-4 fw-bold">World class music</h1>
          <p>All new music experiences near you, updated everyday...</p>
          <a href="#eventSection" type="button" class="custom-button">Explore now<i class="bi bi-music-note"></i></a>
        </div>
      </div>
    </div>
  </div>
</div>

<div class="home-content" id="eventSection">
  <p class="p-2 h1 text-center mb-0" style="color: #000000"><strong>Upcoming & Trending events</strong></p>
  <p class="p-3 text-center mb-4" style="color: #000000">Discover music events from all of your favourite genres, near or far.</p>
</div>
{% endblock %}

{% block content %}
<div class="d-flex flex-wrap justify-content-center gap-3">
  <a class="custom-button-categories" style="text-decoration: none;"
     href="{{ url_for('event.categorise', genre='All') }}">Show All</a>
  <a class="custom-button-categories" style="text-decoration: none;"
     href="{{ url_for('event.categorise', genre='pop') }}">Pop</a>
  <a class="custom-button-categories" style="text-decoration: none;"
     href="{{ url_for('event.categorise', genre='rap') }}">Rap</a>
  <a class="custom-button-categories" style="text-decoration: none;"
     href="{{ url_for('event.categorise', genre='country') }}">Country</a>
  <a class="custom-button-categories" style="text-decoration: none;"
     href="{{ url_for('event.categorise', genre='edm') }}">EDM</a>
  <a class="custom-button-categories" style="text-decoration: none;"
     href="{{ url_for('event.categorise', genre='rock') }}">Rock</a>

  <h5 class="my-3">Filter by location:</h5>
  <input type="text" class="form-control" aria-label="Sizing example input" placeholder="Eg. Brisbane, Australia"
    aria-describedby="inputGroup-sizing-default" style="max-width: 250px">
</div>

<!-- Database Events Section -->
<section class="mt-3">
  {% if events and events|length > 0 %}
  <div class="row">
    {% for event in events %}
    <div class="col-12 col-md-6 col-lg-3 mb-4" data-genre="{{ event.genre }}">
      <a href="{{ url_for('event.show', id=event.id) }}" style="text-decoration: none;">
        <div class="custom-card" height="30" width="400">
          <div class="position-relative">
            <img src="{{ event.image or url_for('static', filename='img/concert1.jpg') }}" 
                 class="card-img-top" alt="{{ event.name }}" style="height: 250px; object-fit: cover;">
            <span class="badge 
              {% if event.status == 'Open' %}text-bg-success
              {% elif event.status == 'Sold Out' %}text-bg-danger
              {% elif event.status == 'Cancelled' %}text-bg-info
              {% elif event.status == 'Inactive' %}text-bg-secondary
              {% else %}text-bg-warning{% endif %} 
              position-absolute m-2 top-0 start-0 fs-5">
              {{ event.status }}
            </span>
          </div>

          <div class="p-3 custom-card-body">
            <div class="d-flex">
              <div class="date text-center me-3">
                {% if event.date %}
                <div class="day-font">{{ event.date.strftime('%d') }}</div>
                <div class="month-font">{{ event.date.strftime('%b').upper() }}</div>
                {% else %}
                <div class="day-font">TBA</div>
                <div class="month-font">DATE</div>
                {% endif %}
              </div>

              <div>
                <h5 class="card-title mb-2">{{ event.name }}</h5>
                <p class="card-text mb-1"><strong>Genre:</strong> {{ event.genre|title }}</p>
                <p class="card-text mb-1"><strong>Location:</strong> 
                  {% if event.currency == 'AUD' %}Australia
                  {% elif event.currency == 'USD' %}USA
                  {% else %}International{% endif %}
                </p>
                {% if event.date %}
                <p class="card-text mb-1"><strong>Time:</strong> {{ event.date.strftime('%I:%M %p') }}</p>
                {% else %}
                <p class="card-text mb-1"><strong>Time:</strong> TBA</p>
                {% endif %}
                <p class="ticket-font mb-1">
                  <strong>Price:</strong> 
                  {% if event.status == 'Open' %}From {{ event.currency }}120
                  {% elif event.status == 'Sold Out' %}Sold Out
                  {% elif event.status == 'Cancelled' %}Cancelled
                  {% else %}Unavailable{% endif %}
                </p>
              </div>
            </div>
          </div>
        </div>
      </a>
    </div>
    {% endfor %}
  </div>
  {% else %}
  <!-- Fallback to sample events if no database events -->
  <div class="text-center py-5">
    <p class="text-muted">No events found in database. Here are some sample events:</p>
  </div>
  
  <!-- Sample events (you can remove this section after populating your database) -->
  <div class="row">
    <!-- Sample Event 1 -->
    <div class="col-12 col-md-6 col-lg-3 mb-4">
      <a href="#" style="text-decoration: none;">
        <div class="custom-card" height="30" width="400">
          <div class="position-relative">
            <img src="{{ url_for('static', filename='img/concert1.jpg') }}" class="card-img-top" alt="..." style="height: 250px;">
            <span class="badge text-bg-success position-absolute m-2 top-0 start-0 fs-5">Open</span>
          </div>
          <div class="p-3 custom-card-body">
            <div class="d-flex">
              <div class="date text-center me-3">
                <div class="day-font">22</div>
                <div class="month-font">AUG</div>
              </div>
              <div>
                <h5 class="card-title mb-2">Coldplay: Music of the Spheres</h5>
                <p class="card-text mb-1"><strong>Genre:</strong> Pop</p>
                <p class="card-text mb-1"><strong>Location:</strong> Brisbane, Australia</p>
                <p class="card-text mb-1"><strong>Time:</strong> 9:00PM</p>
                <p class="ticket-font mb-1">Price: $120</p>
              </div>
            </div>
          </div>
        </div>
      </a>
    </div>
    
    <!-- Add more sample events as needed -->
  </div>
  {% endif %}
</section>

<!-- Featured Events Carousel -->
<div class="p-2 home-content text-center mt-5">
  <p class="h1 text-center" style="color: #000000"><strong>Event Spotlight</strong></p>
  <p style="color: #000000;">The events that everyone is talking about...</p>
</div>

<!-- Promotional images carousel with database events -->
<div id="carouselExampleCaptions" class="carousel slide mx-auto" style="max-width: 1200px; max-height: 500px;">
  <div class="carousel-indicators">
    {% if events and events|length > 0 %}
      {% for event in events[:3] %}
      <button type="button" data-bs-target="#carouselExampleCaptions" data-bs-slide-to="{{ loop.index0 }}" 
              class="{% if loop.first %}active{% endif %}" aria-label="Slide {{ loop.index }}"></button>
      {% endfor %}
    {% else %}
      <button type="button" data-bs-target="#carouselExampleCaptions" data-bs-slide-to="0" class="active" aria-label="Slide 1"></button>
      <button type="button" data-bs-target="#carouselExampleCaptions" data-bs-slide-to="1" aria-label="Slide 2"></button>
      <button type="button" data-bs-target="#carouselExampleCaptions" data-bs-slide-to="2" aria-label="Slide 3"></button>
    {% endif %}
  </div>

  <div class="carousel-inner rounded-3">
    {% if events and events|length > 0 %}
      {% for event in events[:3] %}
      <div class="carousel-item {% if loop.first %}active{% endif %}">
        <img src="{{ event.image or url_for('static', filename='img/concert' ~ loop.index ~ '.jpg') }}" 
             class="d-block w-100" alt="{{ event.name }}" style="max-width: 1200px; max-height: 500px; object-fit: cover;">
        <div class="carousel-caption d-none d-md-block">
          <h5><strong>{{ event.genre|title }}</strong> &bull; {{ event.name }}</h5>
          <p>{{ event.description[:100] }}{% if event.description|length > 100 %}...{% endif %}</p>
        </div>
      </div>
      {% endfor %}
    {% else %}
      <!-- Fallback carousel items -->
      <div class="carousel-item active">
        <img src="{{ url_for('static', filename='img/concert1.jpg') }}" class="d-block w-100" alt="..." style="max-width: 1200px; max-height: 500px;">
        <div class="carousel-caption d-none d-md-block">
          <h5><strong>Pop</strong> &bull; Coldplay: Music of the Spheres World Tour in Japan</h5>
        </div>
      </div>
      <div class="carousel-item">
        <img src="{{ url_for('static', filename='img/concert2.jpg') }}" class="d-block w-100" alt="..." style="max-width: 1200px; max-height: 500px;">
        <div class="carousel-caption d-none d-md-block">
          <h5><strong>Pop</strong> &bull; Coldplay: Music of the Spheres World Tour in Australia</h5>
        </div>
      </div>
      <div class="carousel-item">
        <img src="{{ url_for('static', filename='img/concert3.jpg') }}" class="d-block w-100" alt="..." style="max-width: 1200px; max-height: 500px;">
        <div class="carousel-caption d-none d-md-block">
          <h5><strong>Pop</strong> &bull; Coldplay: Music of the Spheres World Tour in New Zealand</h5>
        </div>
      </div>
    {% endif %}
  </div>
  
  <button class="carousel-control-prev" type="button" data-bs-target="#carouselExampleCaptions" data-bs-slide="prev">
    <span class="carousel-control-prev-icon" aria-hidden="true"></span>
    <span class="visually-hidden">Previous</span>
  </button>
  <button class="carousel-control-next" type="button" data-bs-target="#carouselExampleCaptions" data-bs-slide="next">
    <span class="carousel-control-next-icon" aria-hidden="true"></span>
    <span class="visually-hidden">Next</span>
  </button>
</div>

<!-- Show More Button -->
<div class="d-flex justify-content-center align-item-center mt-5">
  <button class="custom-button-categories" style="width: 500px;">Show more...</button>
</div>

</main>
{% endblock %}
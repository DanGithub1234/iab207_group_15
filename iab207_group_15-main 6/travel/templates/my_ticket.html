\\<!-- templates/events/my_tickets.html -->
{% extends 'base.html' %}

{% block content %}
<div class="container mt-4">
    <div class="d-flex justify-content-between align-items-center mb-4">
        <h2><i class="bi bi-ticket-perforated me-2"></i>My Tickets</h2>
        <a href="{{ url_for('main.index') }}" class="btn btn-outline-primary">
            <i class="bi bi-arrow-left me-1"></i>Back to Events
        </a>
    </div>

    {% if bookings %}
    <div class="row">
        {% for booking in bookings %}
        <div class="col-12 col-lg-6 mb-4">
            <div class="card ticket-card h-100 shadow-sm">
                <div class="card-header d-flex justify-content-between align-items-center">
                    <h5 class="card-title mb-0 text-truncate">{{ booking.event.name }}</h5>
                    <span class="badge 
                        {% if booking.status == 'Confirmed' %}bg-success
                        {% elif booking.status == 'Cancelled' %}bg-danger
                        {% else %}bg-warning{% endif %}">
                        {{ booking.status }}
                    </span>
                </div>
                
                <div class="card-body">
                    <!-- Event Image -->
                    <div class="text-center mb-3">
                        <img src="{{ booking.event.image or url_for('static', filename='img/concert1.jpg') }}" 
                             class="img-fluid rounded" 
                             alt="{{ booking.event.name }}"
                             style="max-height: 200px; width: 100%; object-fit: cover;">
                    </div>

                    <!-- Event Details -->
                    <div class="event-details">
                        <p class="card-text"><strong>Description:</strong> {{ booking.event.description }}</p>
                        
                        <div class="row">
                            <div class="col-6">
                                <p class="mb-2"><strong>Genre:</strong></p>
                                <span class="badge bg-primary">{{ booking.event.genre|title }}</span>
                            </div>
                            <div class="col-6">
                                <p class="mb-2"><strong>Event Status:</strong></p>
                                <span class="badge 
                                    {% if booking.event.status == 'Open' %}bg-success
                                    {% elif booking.event.status == 'Sold Out' %}bg-danger
                                    {% elif booking.event.status == 'Cancelled' %}bg-info
                                    {% elif booking.event.status == 'Inactive' %}bg-secondary
                                    {% else %}bg-warning{% endif %}">
                                    {{ booking.event.status }}
                                </span>
                            </div>
                        </div>

                        <hr>

                        <!-- Booking Information -->
                        <div class="booking-info">
                            <div class="row">
                                <div class="col-6">
                                    <p class="mb-1"><strong><i class="bi bi-calendar-event me-1"></i>Event Date:</strong></p>
                                    <p class="text-muted">
                                        {% if booking.event.date %}
                                            {{ booking.event.date.strftime('%b %d, %Y') }}<br>
                                            <small>{{ booking.event.date.strftime('%I:%M %p') }}</small>
                                        {% else %}
                                            TBA
                                        {% endif %}
                                    </p>
                                </div>
                              
                            </div>

                            
                        </div>
                    </div>
                </div>

                <div class="card-footer bg-transparent">
                    <div class="d-flex justify-content-between align-items-center">
                        <a href="{{ url_for('event.show', id=booking.event.id) }}" 
                           class="btn btn-primary btn-sm">
                            <i class="bi bi-eye me-1"></i>View Event
                        </a>
                        
                        {% if booking.status == 'Confirmed' and booking.event.status == 'Open' %}
                        <button class="btn btn-outline-danger btn-sm" 
                                onclick="cancelBooking('{{ booking.id }}')"
                                data-bs-toggle="tooltip" 
                                title="Cancel this booking">
                            <i class="bi bi-x-circle me-1"></i>Cancel
                        </button>
                        {% elif booking.event.status == 'Cancelled' %}
                        <span class="badge bg-info">Event Cancelled</span>
                        {% elif booking.event.status == 'Inactive' %}
                        <span class="badge bg-secondary">Event Ended</span>
                        {% endif %}
                    </div>
                </div>
            </div>
        </div>
        {% endfor %}
    </div>

    <!-- Booking Stats -->
    <div class="row mt-4">
        <div class="col-12">
            <div class="card">
                <div class="card-body">
                    <h5 class="card-title">Booking Summary</h5>
                    <div class="row text-center">
                        <div class="col-4">
                            <h4 class="text-primary">{{ bookings|length }}</h4>
                            <p class="text-muted mb-0">Total Bookings</p>
                        </div>
                        <div class="col-4">
                            <h4 class="text-success">
                                {{ bookings|selectattr('status', 'equalto', 'Confirmed')|list|length }}
                            </h4>
                            <p class="text-muted mb-0">Confirmed</p>
                        </div>
                        <div class="col-4">
                            <h4 class="text-warning">
                                {{ bookings|selectattr('event.status', 'equalto', 'Upcoming')|list|length }}
                            </h4>
                            <p class="text-muted mb-0">Upcoming</p>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    {% else %}
    <!-- No Tickets State -->
    <div class="text-center py-5">
        <div class="card border-0">
            <div class="card-body py-5">
                <div class="empty-state-icon mb-4">
                    <i class="bi bi-ticket-x display-1 text-muted"></i>
                </div>
                <h3 class="text-muted">No Tickets Yet</h3>
                <p class="text-muted mb-4">You haven't booked any events yet. Start exploring amazing events near you!</p>
                <a href="{{ url_for('main.index') }}" class="btn btn-primary btn-lg">
                    <i class="bi bi-music-note me-2"></i>Browse Events
                </a>
            </div>
        </div>
    </div>
    {% endif %}
</div>

<!-- JavaScript for cancel booking -->
<script>
function cancelBooking(bookingId) {
    if (confirm('Are you sure you want to cancel this booking? This action cannot be undone.')) {
        // Here you would typically make an AJAX call to cancel the booking
        // For now, we'll just show an alert
        alert('Booking cancellation feature coming soon!');
        // Example AJAX call:
        // fetch(`/bookings/${bookingId}/cancel`, { method: 'POST' })
        // .then(response => response.json())
        // .then(data => {
        //     if (data.success) {
        //         location.reload();
        //     }
        // });
    }
}

// Initialize tooltips
document.addEventListener('DOMContentLoaded', function() {
    var tooltipTriggerList = [].slice.call(document.querySelectorAll('[data-bs-toggle="tooltip"]'));
    var tooltipList = tooltipTriggerList.map(function (tooltipTriggerEl) {
        return new bootstrap.Tooltip(tooltipTriggerEl);
    });
});
</script>

<style>
.ticket-card {
    border-left: 4px solid #007bff;
    transition: transform 0.2s ease-in-out;
}

.ticket-card:hover {
    transform: translateY(-2px);
}

.empty-state-icon {
    opacity: 0.5;
}

.card-header {
    background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
    color: white;
}

.badge {
    font-size: 0.75em;
}
</style>
{% endblock %}